(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21e593"],{d4d1:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("PageHeader",[r("div",{staticClass:"between-center table-top"},[r("div",[r("MySelect",{attrs:{list:e.cates,text:"项目种类"},on:{change:e.refresh},model:{value:e.cateId,callback:function(t){e.cateId=t},expression:"cateId"}})],1),r("div",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push(e.prefix+"/create")}}},[e._v("新建")])],1)]),r("ResTable",{attrs:{drag:!!e.cateId,prefix:e.prefix},on:{refresh:e.fetchData},model:{value:e.list,callback:function(t){e.list=t},expression:"list"}}),r("div",{staticClass:"all-center table-page"},[e.cateId?r("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("保存排序")]):r("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.size,"current-page":e.current},on:{"update:currentPage":function(t){e.current=t},"update:current-page":function(t){e.current=t}}})],1)],1)},a=[],c=(r("96cf"),r("1da1")),i=r("5530"),s=r("365c"),o=r("08f3"),l=r("2f62"),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r(e.drag?"el-table-draggable":"div",{tag:"component",on:{drop:e.changeList}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,"row-key":"id"}},[r("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),r("el-table-column",{attrs:{prop:"cate.name",label:"所属种类",width:"120"}}),r("el-table-column",{attrs:{prop:"sort",label:"排序",width:"100"}}),r("el-table-column",{attrs:{prop:"desc",label:"图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{staticStyle:{width:"200px",height:"100px"},attrs:{src:e._f("img")(t.row.url),fit:"cover","preview-src-list":[e.$resolveImg(t.row.url)],lazy:""}})]}}])}),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{staticStyle:{"margin-right":"6px"},attrs:{size:"mini"},on:{click:function(r){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),r("el-popconfirm",{attrs:{title:"确定删除吗？"},on:{onConfirm:function(r){return e.handleDelete(t.$index,t.row)}}},[r("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],1)},d=[],p=(r("99af"),r("d81d"),{name:"ResTable",model:{prop:"list",event:"change"},props:{list:{default:function(){return[]}},prefix:{default:""},drag:{default:!1}},data:function(){return{}},created:function(){},methods:{handleEdit:function(e,t){this.$router.push("".concat(this.prefix,"/create?id=").concat(t.id))},handleDelete:function(e,t){var r=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s["a"].resource.del(t.id);case 2:r.$toast("删除成功"),r.$$emit("change");case 4:case"end":return e.stop()}}),e)})))()},changeList:function(e){var t=e.list.length,r=e.list.map((function(e,r){return Object(i["a"])({},e,{sort:t-r})}));this.$emit("change",r)}}}),f=p,h=r("2877"),g=Object(h["a"])(f,u,d,!1,null,null,null),b=g.exports,m={name:"CateList",components:{ResTable:b},data:function(){return{loading:!1,cateId:"",prefix:"/project/resource",content:"",total:0,current:1,size:10,list:[],cityId:"",cities:o["a"]}},created:function(){this.fetchData()},computed:Object(i["a"])({},Object(l["c"])({cates:"cates"})),methods:{fetchData:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.loading){t.next=2;break}return t.abrupt("return");case 2:if(e.loading=!0,t.prev=3,!e.cateId){t.next=8;break}e.fetchByCate(),t.next=16;break;case 8:return e.loading=!1,r={current:e.current,size:e.size},e.cityId&&(r.cityId=e.cityId),t.next=13,s["a"].resource.getList(r);case 13:n=t.sent,e.list=n.records,e.total=n.total;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](3),console.log(t.t0);case 21:e.loading=!1;case 22:case"end":return t.stop()}}),t,null,[[3,18]])})))()},fetchByCate:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={cateId:e.cateId},t.next=3,s["a"].resource.getListByCate(r);case 3:n=t.sent,e.list=n;case 5:case"end":return t.stop()}}),t)})))()},refresh:function(){this.current=1,this.fetchData()},save:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,s["a"].resource.updateMany({list:e.list});case 4:e.$toast("更新成功"),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](1),console.log(t.t0);case 10:e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[1,7]])})))()}},watch:{current:function(e){this.fetchData()}}},v=m,w=Object(h["a"])(v,n,a,!1,null,null,null);t["default"]=w.exports}}]);